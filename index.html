<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IntelLexa Event Voting Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #eef2ff, #f9fafb);
      font-family: 'Inter', sans-serif;
    }
    .event-card {
      transition: all 0.25s ease-in-out;
    }
    .event-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }
    .vote-btn {
      transition: all 0.2s;
    }
    .vote-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
    }
    .glass-panel {
      backdrop-filter: blur(12px);
      background: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    #posterPreview {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
    }
  </style>
</head>
<body class="min-h-screen p-6">

  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-10">
      <div>
        <h1 class="text-4xl font-extrabold text-blue-800 tracking-tight">IntelLexa Event Voting</h1>
        <p class="text-gray-600 text-lg">Rajalakshmi Engineering College</p>
      </div>
      <button id="loginPageBtn"
        class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white px-5 py-2.5 rounded-xl shadow-lg font-medium transition">
        Admin Login
      </button>
    </div>

    <!-- Admin Login -->
    <div id="loginPage" class="hidden glass-panel p-8 rounded-2xl shadow-xl max-w-md mx-auto">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">üîí Admin Login</h2>
      <form id="adminLoginForm" class="space-y-5">
        <input type="password" id="adminPassword" placeholder="Enter admin password"
          class="border p-3 w-full rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required />
        <div class="flex justify-between">
          <button type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow">Login</button>
          <button type="button" id="backBtnLogin"
            class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg shadow">Back</button>
        </div>
      </form>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden glass-panel mb-10 p-8 rounded-2xl shadow-xl">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-semibold text-gray-800 flex items-center gap-2">‚öôÔ∏è Admin Panel</h2>
        <button id="backBtn"
          class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg shadow transition">‚Üê Back</button>
      </div>

      <!-- Event Form -->
      <form id="addEventForm" class="flex flex-wrap gap-4 items-center mb-8">
        <input type="hidden" id="editEventId" />
        <input type="text" id="eventName" placeholder="Event name"
          class="border p-3 rounded-lg w-full sm:w-1/4 focus:ring-2 focus:ring-blue-400 focus:outline-none" required />
        <input type="text" id="eventDesc" placeholder="Description"
          class="border p-3 rounded-lg w-full sm:w-1/3 focus:ring-2 focus:ring-blue-400 focus:outline-none" required />
        <input type="file" id="eventPoster" accept="image/*"
          class="border p-3 rounded-lg w-full sm:w-1/3 bg-white" />
        <img id="posterPreview" class="hidden mt-2" alt="Poster preview" />
        <div class="flex gap-3 w-full mt-3">
          <button type="submit" id="submitBtn"
            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow transition">Add Event</button>
          <button type="button" id="clearVotes"
            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow transition">Clear Votes</button>
        </div>
      </form>

      <div id="adminEventGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
    </div>

    <!-- User Event Grid -->
    <div id="eventGrid" class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3"></div>
  </div>

  <script>
  const API_BASE = "https://intellexa-backend.onrender.com";// change if deployed
  let events = [];

  // DOM refs
  const eventGrid = document.getElementById("eventGrid");
  const adminEventGrid = document.getElementById("adminEventGrid");
  const adminPanel = document.getElementById("adminPanel");
  const loginPage = document.getElementById("loginPage");
  const loginBtn = document.getElementById("loginPageBtn");
  const backBtnLogin = document.getElementById("backBtnLogin");
  const backBtn = document.getElementById("backBtn");
  const adminLoginForm = document.getElementById("adminLoginForm");
  const addEventForm = document.getElementById("addEventForm");
  const clearVotesBtn = document.getElementById("clearVotes");
  const posterInput = document.getElementById("eventPoster");
  const posterPreview = document.getElementById("posterPreview");
  const editEventId = document.getElementById("editEventId");
  const submitBtn = document.getElementById("submitBtn");

  // Utility: Disable/Enable all buttons temporarily
  function setButtonsDisabled(state) {
    document.querySelectorAll("button").forEach(btn => {
      btn.disabled = state;
      btn.style.opacity = state ? "0.6" : "1";
      btn.style.cursor = state ? "not-allowed" : "pointer";
    });
  }

  // --- Fetch Events ---
  async function fetchEvents() {
    const res = await fetch(`${API_BASE}/events`);
    events = await res.json();
    renderEvents();
    renderAdminEvents();
  }

  // --- Poster Preview ---
  posterInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = ev => {
        posterPreview.src = ev.target.result;
        posterPreview.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }
  });

  // --- Render (User) ---
  function renderEvents() {
    eventGrid.innerHTML = "";
    events.forEach(e => {
      const card = document.createElement("div");
      card.className = "event-card bg-white rounded-2xl shadow p-5";
      card.innerHTML = `
        <div class="h-40 bg-gray-200 rounded-xl mb-4 overflow-hidden flex justify-center items-center">
          ${e.poster ? `<img src="${e.poster}" class="w-full h-full object-cover"/>`
            : `<span class="text-3xl font-bold text-gray-500">${e.name[0]}</span>`}
        </div>
        <h3 class="text-lg font-bold text-gray-800 mb-2">${e.name}</h3>
        <p class="text-gray-500 mb-4">${e.desc}</p>
        <div class="flex justify-center items-center gap-5">
          <button class="vote-btn bg-red-500 text-white w-10 h-10 rounded-full flex justify-center items-center text-lg" onclick="vote(${e.id}, -1)">üëé</button>
          <div class="text-center">
            <div id="count-${e.id}" class="text-2xl font-bold text-gray-800">${e.votes}</div>
            <div class="text-gray-500 text-sm">votes</div>
          </div>
          <button class="vote-btn bg-green-500 text-white w-10 h-10 rounded-full flex justify-center items-center text-lg" onclick="vote(${e.id}, 1)">üëç</button>
        </div>
      `;
      eventGrid.appendChild(card);
    });
  }

  // --- Render (Admin) ---
  function renderAdminEvents() {
    adminEventGrid.innerHTML = "";
    events.forEach(e => {
      const card = document.createElement("div");
      card.className = "event-card bg-white rounded-2xl shadow p-5";
      card.innerHTML = `
        <div class="h-40 bg-gray-200 rounded-xl mb-4 overflow-hidden flex justify-center items-center">
          ${e.poster ? `<img src="${e.poster}" class="w-full h-full object-cover"/>`
            : `<span class="text-3xl font-bold text-gray-500">${e.name[0]}</span>`}
        </div>
        <h3 class="text-lg font-bold text-gray-800 mb-2">${e.name}</h3>
        <p class="text-gray-500 mb-4">${e.desc}</p>
        <p class="text-gray-700 font-semibold mb-2">Votes: ${e.votes}</p>
        <div class="flex justify-between">
          <button onclick="editEvent(${e.id})" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded">Edit</button>
          <button onclick="deleteEvent(${e.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">Delete</button>
        </div>
      `;
      adminEventGrid.appendChild(card);
    });
  }

  // --- Vote ---
  async function vote(id, delta) {
    setButtonsDisabled(true);
    try {
      const form = new FormData();
      form.append("delta", delta);
      await fetch(`${API_BASE}/vote/${id}`, { method: "POST", body: form });
      await fetchEvents();
    } finally {
      setButtonsDisabled(false);
    }
  }

  // --- Add/Edit Event ---
  addEventForm.onsubmit = async (e) => {
    e.preventDefault();
    setButtonsDisabled(true);

    try {
      const name = document.getElementById("eventName").value;
      const desc = document.getElementById("eventDesc").value;
      const poster = posterInput.files[0];

      const form = new FormData();
      form.append("name", name);
      form.append("desc", desc);
      if (poster) form.append("poster", poster);

      if (editEventId.value) {
        await fetch(`${API_BASE}/events/${editEventId.value}`, { method: "PUT", body: form });
      } else {
        await fetch(`${API_BASE}/events`, { method: "POST", body: form });
      }

      resetForm();
      await fetchEvents();
    } finally {
      setButtonsDisabled(false);
    }
  };

  function resetForm() {
    addEventForm.reset();
    posterPreview.classList.add("hidden");
    editEventId.value = "";
    submitBtn.textContent = "Add Event";
  }

  async function editEvent(id) {
    const e = events.find(ev => ev.id === id);
    document.getElementById("eventName").value = e.name;
    document.getElementById("eventDesc").value = e.desc;
    if (e.poster) {
      posterPreview.src = e.poster;
      posterPreview.classList.remove("hidden");
    }
    editEventId.value = id;
    submitBtn.textContent = "Update Event";
  }

  async function deleteEvent(id) {
    if (confirm("Delete this event?")) {
      setButtonsDisabled(true);
      try {
        await fetch(`${API_BASE}/events/${id}`, { method: "DELETE" });
        await fetchEvents();
      } finally {
        setButtonsDisabled(false);
      }
    }
  }

  clearVotesBtn.onclick = async () => {
    if (confirm("Reset all votes?")) {
      setButtonsDisabled(true);
      try {
        await fetch(`${API_BASE}/events/reset_votes`, { method: "POST" });
        await fetchEvents();
      } finally {
        setButtonsDisabled(false);
      }
    }
  };

  // --- Admin Login ---
  adminLoginForm.onsubmit = async (e) => {
    e.preventDefault();
    setButtonsDisabled(true);
    try {
      const form = new FormData();
      form.append("password", document.getElementById("adminPassword").value);
      const res = await fetch(`${API_BASE}/admin/login`, { method: "POST", body: form });
      if (res.ok) {
        loginPage.classList.add("hidden");
        adminPanel.classList.remove("hidden");
      } else {
        alert("Invalid admin password");
      }
    } finally {
      setButtonsDisabled(false);
    }
  };

  // --- Page Navigation ---
  loginBtn.onclick = () => {
    loginPage.classList.remove("hidden");
    eventGrid.classList.add("hidden");
    loginBtn.classList.add("hidden");
  };
  backBtnLogin.onclick = () => {
    loginPage.classList.add("hidden");
    eventGrid.classList.remove("hidden");
    loginBtn.classList.remove("hidden");
  };
  backBtn.onclick = () => {
    adminPanel.classList.add("hidden");
    eventGrid.classList.remove("hidden");
    loginBtn.classList.remove("hidden");
  };

  // --- Init ---
  fetchEvents();
</script>

</body>
</html>

